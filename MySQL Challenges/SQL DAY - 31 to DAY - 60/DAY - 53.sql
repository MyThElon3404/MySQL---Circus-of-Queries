-- QUESTION : 1
-- 1. You have three tables: Shapes, Colors, and ShapeColors. The Shapes table contains information about different shapes, 
-- the Colors table stores information about various colors, and the ShapeColors table links shapes with their corresponding colors.

-- Write an SQL query to find the shapes that have exactly two different colors, and for those shapes, list their ShapeName, 
-- the two ColorNames, and the total combined ColorPercentage.

CREATE TABLE Shapes (
    ShapeID INT PRIMARY KEY,
    ShapeName VARCHAR(50) NOT NULL
);

CREATE TABLE Colors (
    ColorID INT PRIMARY KEY,
    ColorName VARCHAR(50) NOT NULL
);

CREATE TABLE ShapeColors (
    ShapeID INT,
    ColorID INT,
    ColorPercentage DECIMAL(5,2),
    PRIMARY KEY (ShapeID, ColorID),
    FOREIGN KEY (ShapeID) REFERENCES Shapes(ShapeID),
    FOREIGN KEY (ColorID) REFERENCES Colors(ColorID)
);
INSERT INTO Shapes (ShapeID, ShapeName) VALUES 
(1, 'Circle'),
(2, 'Triangle'),
(3, 'Square'),
(4, 'Rectangle');

INSERT INTO Colors (ColorID, ColorName) VALUES 
(1, 'Red'),
(2, 'Blue'),
(3, 'Green'),
(4, 'Yellow');

INSERT INTO ShapeColors (ShapeID, ColorID, ColorPercentage) VALUES 
(1, 1, 50.00),  -- Circle (Red)
(1, 2, 50.00),  -- Circle (Blue)
(2, 3, 70.00),  -- Triangle (Green)
(2, 4, 30.00),  -- Triangle (Yellow)
(3, 1, 40.00),  -- Square (Red)
(3, 2, 30.00),  -- Square (Blue)
(3, 3, 30.00),  -- Square (Green)
(4, 2, 60.00),  -- Rectangle (Blue)
(4, 3, 40.00);  -- Rectangle (Green)

-- SOLUTION :------------------------------------------------------------------------------------------------------------------------

WITH ShapeColorDetails AS (
    SELECT 
        s.ShapeName, 
        c.ColorName,
        sc.ColorPercentage
    FROM ShapeColors AS sc
    JOIN Shapes AS s ON sc.ShapeID = s.ShapeID
    JOIN Colors AS c ON sc.ColorID = c.ColorID
)
SELECT 
    ShapeName,
    STRING_AGG(ColorName, ', ') AS ColorNames,
    SUM(ColorPercentage) AS TotalColorPercentage
FROM ShapeColorDetails
GROUP BY ShapeName
HAVING COUNT(DISTINCT ColorName) = 2;

--------------------------------------- OR ----------------------------------------------------

WITH ShapeColorDetails AS (
    SELECT 
        s.ShapeName,
        c.ColorName,
        sc.ColorPercentage
    FROM ShapeColors sc
    JOIN Shapes s ON sc.ShapeID = s.ShapeID
    JOIN Colors c ON sc.ColorID = c.ColorID
),
FilteredShapes AS (
    SELECT 
        ShapeName,
        COUNT(DISTINCT ColorName) AS ColorCount,
        MAX(ColorName) AS Color1,
        MIN(ColorName) AS Color2,
        SUM(ColorPercentage) AS TotalColorPercentage
    FROM ShapeColorDetails
    GROUP BY ShapeName
    HAVING COUNT(DISTINCT ColorName) = 2
)
SELECT ShapeName, Color1, Color2, TotalColorPercentage
FROM FilteredShapes;

-- ==================================================================================================================================

-- QUESTION : 2
-- 2. You are given two tables, Sales and Products. The Sales table records individual sales transactions, 
-- while the Products table contains information about a range of products.

-- Your objective is to write an SQL query to calculate the total revenue generated by each product within all categories. 
-- The output should be correct up to 2 decimal places. Sort the final output alphabetically by category and the by total_revenue 
-- in descending order.



-- SOLUTION :------------------------------------------------------------------------------------------------------------------------



-- ==================================================================================================================================
